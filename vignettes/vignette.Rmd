---
title: "Reduction of speckle interferometric binary stars"
author: "Denis Rastegaev"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Reduction of binary stars}
  %\VignetteEngine{knitr::knitr}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Workflow for reduction of speckle interferometric binary stars

### Short way
To obtain positional paramaters and magnitude difference between components of binary star just type

```{r eval = FALSE}
obj_filename <- file.choose() # Choose file with binary star
dark_filename <- file.choose() # Choose dark file
flat_filename <- file.choose() # Choose flat field file
rho_theta_dm <- speckle_binary(object = obj_filename, dark = dark_filename, flat = flat_filename)
print(rho_theta_dm)
```

### Long way
Calculate statistics for object file
```{r eval = FALSE}
obj_filename <- file.choose() # Choose file with binary star
obj_stat <- speckle_stat(obj_filename)
```

Calculate statistics for dark file
```{r eval = FALSE}
dark_filename <- file.choose() # Choose file with dark frames
dark_stat <- speckle_stat(dark_filename)
```

Calculate average dark frame
```{r eval = FALSE}
mid_dark <- middle_frame(filename = dark_filename, stat = dark_stat)
```

Calculate average flat field frame with average dark subtraction
```{r eval = FALSE}
mid_flat <- middle_frame(filename = file.choose() , dark = mid_dark) # Choose file with flat fields
```

Calculate power spectrum with subtraction of neighboring frame
```{r eval = FALSE}
ps_diff <- ps(obj_filename, dark = NULL, flat = NULL, diff = 1)
```

Calculate acf
```{r eval = FALSE}
acf <- speckle_acf(ps_diff)
```

Find secondary peaks on acf
```{r eval = FALSE}
rho_theta_first <- find_peak(acf)
```

Calculate power spectrum
```{r eval = FALSE}
ps <- ps(obj_filename, dark = mid_dark, flat = mid_flat, diff = 0) # include stats
```

Power spectrum cosmetic operation
```{r eval = FALSE}
ps_cosm <- ps_cosmetic(ps)
```

Calculate rho, theta and dm using Pluzhnik (2005) algorithm
```{r eval = FALSE}
rho_theta_dm_ccd <- (ps_cosm)
```

Find real rho and theta
```{r eval = FALSE}
rho_theta_dm <- zqt(rho_theta_dm_ccd)
```

![Power spectrum](Power_spectrum.png)

